# 仕様書：雛人形とインテリアの色彩調和システム (`index.html`)

## 1. 概要

本ファイルは、「せせらぎ企画室」が提供する、雛人形とインテリアの色彩調和を提案するシングルページのWebアプリケーションです。ユーザーが雛人形とお部屋の写真をアップロードすると、それぞれの写真から主要な色を抽出し、調和の取れたインテリアカラーコーディネートを提案します。

## 2. ファイル構成

単一のHTMLファイル (`index.html`) で構成されており、CSSとJavaScriptはファイル内に直接記述されています。

-   **HTML**: アプリケーションの骨格となる構造を定義します。
-   **CSS**: アプリケーションの見た目とレスポンシブデザインを定義します。
-   **JavaScript**: 画像処理、カラーパレット抽出、DOM操作などの動的な機能を実装します。

## 3. 外部ライブラリ

-   **Color Thief** (`color-thief.umd.js`)
    -   **ソース**: CDN (cdnjs.cloudflare.com)
    -   **役割**: 画像からドミナントカラーやカラーパレットを抽出するために使用されます。

## 4. 画面レイアウト

画面は主に3つのセクションで構成されています。

### 4.1. ヘッダー (`<header>`)

-   アプリケーションのタイトル「せせらぎ企画室」とサブタイトル「雛人形とインテリアの色彩調和システム」を表示します。

### 4.2. 画像解析セクション (`.analysis-section`)

左右に分かれた2つの画像アップロードエリアで構成されます。

-   **左側: 雛人形の写真アップロード**
    -   タイトル: `1. お雛様の写真をアップロード`
    -   機能:
        -   画像プレビュー表示エリア (`#doll-preview`)
        -   ファイル選択ボタン (`#doll-upload`)
        -   抽出されたカラーパレット表示エリア (`#doll-palette`)
-   **右側: お部屋の写真アップロード**
    -   タイトル: `2. お部屋の写真をアップロード`
    -   機能:
        -   画像プレビュー表示エリア (`#interior-preview`)
        -   ファイル選択ボタン (`#interior-upload`)
        -   抽出されたカラーパレット表示エリア (`#interior-palette`)

### 4.3. 結果表示セクション (`.result-section`)

-   タイトル: `3. 色彩調和のご提案`
-   初期状態では、両方の画像をアップロードするよう促すメッセージが表示されます。
-   両方の画像が処理されると、このエリア (`#harmony-suggestion`) に調和案が表示されます。
    -   **提案カラー**: ベースカラー(70%)、アソートカラー(25%)、アクセントカラー(5%)の3色がカラーチップとHEXコードで表示されます。
    -   **アドバイス**: 提案された3色を使った具体的なインテリアコーディネートのアドバイスが文章で表示されます。

### 4.4. レスポンシブデザイン

-   画面幅が `768px` 以下の場合、画像解析セクションの左右のエリアが縦並びのレイアウトに変わります。

## 5. 機能仕様

### 5.1. 画像アップロード機能

-   ユーザーは「写真を選択」ボタンから、雛人形とお部屋のJPEGまたはPNG形式の画像をそれぞれアップロードできます。
-   アップロードされた画像は、それぞれのプレビューエリアに表示されます。

### 5.2. カラーパレット抽出機能

-   画像がアップロードされ、プレビュー表示が完了すると、JavaScriptは`Color Thief`ライブラリを使用して画像から5色のカラーパレットを非同期で抽出します。
-   抽出されたパレットは、各プレビューエリアの下に円形のカラーチップで表示されます。

### 5.3. 色彩調和提案機能

-   雛人形とお部屋の両方のカラーパレットが抽出されると、自動的に実行されます。
-   **ロジック**:
    1.  お部屋のパレットから2色を取得し、「ベースカラー」「アソートカラー」とします。
    2.  雛人形のパレットから最も彩度の高い色を探索し、「アクセントカラー」とします。
    3.  これら3つの色を結果表示セクションに表示し、お部屋にアクセントカラーを取り入れる具体的なアドバイスを生成・表示します。

## 6. JavaScriptロジック

### 6.1. 主要な変数・定数

-   `colorThief`: `ColorThief`クラスのインスタンス。
-   `analysisResults`: 雛人形（doll）とお部屋（interior）の解析結果（カラーパレット）を保持するオブジェクト。

### 6.2. 主要な関数

-   `handleImageUpload(event, type, previewEl, paletteEl)`
    -   画像アップロード時のメイン処理を担当します。
    -   ファイルの読み込み、プレビュー表示、`Color Thief`によるパレット抽出、`displayPalette`および`generateHarmonySuggestion`の呼び出しを行います。
-   `displayPalette(palette, container)`
    -   抽出されたカラーパレットを受け取り、指定されたコンテナ要素内にカラーチップを生成して表示します。
-   `generateHarmonySuggestion()`
    -   `analysisResults`に格納された2つのパレットを基に、色彩調和の提案（HTML）を生成し、画面に表示します。
-   `findMostSaturatedColor(palette)`
    -   パレット（RGB値の配列）の中から、HSL変換を利用して最も彩度（Saturation）の高い色を見つけ出し、そのRGB値を返します。

### 6.3. ユーティリティ関数

-   `rgbToHex(r, g, b)`: RGB値を16進数のカラーコード（例: `#D2B48C`）に変換します。
-   `rgbToHsl(r, g, b)`: RGB値をHSL（色相、彩度、輝度）に変換します。`findMostSaturatedColor`関数内で使用されます。

## 7. CSS設計

-   **CSS変数 (Custom Properties)**
    -   `--base-color`, `--main-color`など、サイト全体のキーカラーを変数として定義しており、一貫性のあるデザインとメンテナンス性の向上を図っています。
-   **クラス設計**
    -   `container`, `analysis-section`, `image-analyzer`, `result-section`など、BEM（Block, Element, Modifier）に似た命名規則で、構造的かつ直感的なクラス名が使用されています。
    -   汎用的なボタンスタイルとして`.btn`クラスが定義されています。
